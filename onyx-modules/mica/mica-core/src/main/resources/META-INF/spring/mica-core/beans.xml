<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="
	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">

  <tx:annotation-driven transaction-manager="transactionManager" />


  <bean id="micaWaitingState" parent="baseStageState" class="org.obiba.onyx.mica.engine.state.MicaWaitingState"
    scope="prototype">
  </bean>

  <bean id="micaReadyState" parent="baseStageState" class="org.obiba.onyx.mica.engine.state.MicaReadyState"
    scope="prototype">
  </bean>

  <bean id="micaNotApplicableState" parent="baseStageState"
    class="org.obiba.onyx.mica.engine.state.MicaNotApplicableState" scope="prototype">
  </bean>

  <bean id="micaInProgressState" parent="baseStageState" class="org.obiba.onyx.mica.engine.state.MicaInProgressState"
    scope="prototype">
    <property name="activeConclusionService" ref="activeConclusionService" />
  </bean>

  <bean id="micaCompletedState" parent="baseStageState" class="org.obiba.onyx.mica.engine.state.MicaCompletedState"
    scope="prototype">
    <property name="activeConclusionService" ref="activeConclusionService" />
  </bean>

  <bean id="activeConclusionService" class="org.obiba.onyx.mica.core.service.impl.DefaultActiveConclusionServiceImpl"
    scope="session">
    <property name="persistenceManager" ref="persistenceManager" />
    <property name="activeInterviewService" ref="activeInterviewService" />    
    <property name="balsacConfirmationRequired" value="${org.obiba.onyx.mica.balsacConfirmationRequired}" />
    <property name="sessionFactory" ref="sessionFactory" />
  </bean>

  <bean id="variableReportContributor" class="org.obiba.onyx.mica.core.service.impl.VariableReportContributor"
    scope="session">
    <property name="reportTemplateLoader" ref="reportTemplateLoader" />
    <property name="activeInterviewService" ref="activeInterviewService" />
    <property name="variableDirectory" ref="variableDirectory" />
    <property name="fieldToVariableMap" value="${org.obiba.onyx.mica.report.fieldToVariable}" />
    <property name="dateFormat" value="${org.obiba.onyx.mica.report.dateFormat}" />
  </bean>
  
  <bean id="reportTemplateLoader" class="org.obiba.onyx.core.io.support.LocalizedResourceLoader">
    <property name="resourcePath" value="${org.obiba.onyx.mica.resources.path}" />
    <property name="resourceName" value="${org.obiba.onyx.mica.report.basename}" />
    <property name="resourceExtension" value=".pdf" />
  </bean>

</beans>